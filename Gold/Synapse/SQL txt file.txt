CREATE SCHEMA gold;

create DATABASE SCOPED CREDENTIAL cred_adwick
WITH
IDENTITY='Managed Identity';
GO

CREATE EXTERNAL DATA SOURCE source_silver
WITH
(
LOCATION = 'https://dataprojectpikachu.blob.core.windows.net/silver',
CREDENTIAL = cred_adwick
);
GO

CREATE EXTERNAL DATA SOURCE source_gold
WITH
(
LOCATION = 'https://dataprojectpikachu.blob.core.windows.net/gold',
CREDENTIAL = cred_adwick
);
GO

CREATE EXTERNAL FILE FORMAT format_parquet
WITH
(
FORMAT_TYPE= PARQUET,
DATA_COMPRESSION = 'org.apache.hadoop.io.compress.SnappyCodec'
);
GO



CREATE EXTERNAL TABLE gold.extcleaned
WITH
(
LOCATION='ext_cleaned',
DATA_SOURCE =source_gold,
FILE_FORMAT =format_parquet
)
AS
SELECT * FROM gold.cleaned;
GO


CREATE EXTERNAL TABLE gold.exttypes
WITH
(
LOCATION='ext_types',
DATA_SOURCE =source_gold,
FILE_FORMAT =format_parquet
)
AS
SELECT * FROM gold.types;
GO



CREATE VIEW gold.cleaned
AS
SELECT *
FROM OPENROWSET(
        BULK 'https://dataprojectpikachu.blob.core.windows.net/silver/pokemon_cleaned/',
        FORMAT = 'PARQUET'
    ) AS quer1;
GO

CREATE VIEW gold.types
AS
SELECT *
FROM OPENROWSET(
        BULK 'https://dataprojectpikachu.blob.core.windows.net/silver/pokemon_types/',
        FORMAT = 'PARQUET'
    ) AS quer1;
GO